<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Path Tester</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #00ff00;
        }
        .container {
            background-color: #000;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        h1 {
            color: #00ffff;
            text-align: center;
        }
        button {
            background-color: #004400;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
            font-family: inherit;
        }
        button:hover {
            background-color: #006600;
        }
        button:disabled {
            background-color: #222;
            color: #666;
            cursor: not-allowed;
        }
        #console {
            background-color: #111;
            border: 1px solid #333;
            padding: 15px;
            margin: 20px 0;
            min-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success { background-color: #004400; border: 1px solid #00ff00; }
        .status.error { background-color: #440000; border: 1px solid #ff0000; color: #ff6666; }
        .status.info { background-color: #000044; border: 1px solid #0066ff; color: #6666ff; }
        .button-group {
            margin: 20px 0;
            text-align: center;
        }
        .progress {
            width: 100%;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #00ff00;
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Sprite Path Tester</h1>

        <div class="status info">
            <strong>Instructions:</strong>
            <ol>
                <li><strong>FIRST:</strong> Click "SCAN LPC FILES FIRST" to discover actual sprite files</li>
                <li>Then click "Load LPC Data" to initialize the LPC sprite data extractor</li>
                <li>Finally click "Test All Paths" to run comprehensive path testing</li>
                <li>Download the generated reports for analysis</li>
            </ol>
        </div>

        <div class="button-group">
            <button id="scanFilesBtn" onclick="runFileScan()" style="background-color: #006600; font-weight: bold;">üìÅ SCAN LPC FILES FIRST</button>
            <button id="loadLPCBtn" onclick="loadLPCData()">üîÑ Load LPC Data</button>
            <button id="testPathsBtn" onclick="runPathTest()" disabled>üß™ Test All Paths</button>
            <button id="quickTestBtn" onclick="runQuickTest()" disabled>‚ö° Quick Test</button>
            <button id="clearConsoleBtn" onclick="clearConsole()">üóëÔ∏è Clear Console</button>
        </div>

        <div class="progress" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div id="console"></div>
    </div>

    <!-- Load required scripts in proper order -->
    <script src="lpc-data-extractor.js"></script>
    <script src="lpc-file-scanner.js"></script>
    <script>
        // Ensure LPCDataExtractor is loaded before proceeding
        if (typeof LPCDataExtractor === 'undefined') {
            console.error('‚ùå LPCDataExtractor failed to load');
        } else {
            console.log('‚úÖ LPCDataExtractor loaded successfully');
        }

        if (typeof LPCFileScanner === 'undefined') {
            console.error('‚ùå LPCFileScanner failed to load');
        } else {
            console.log('‚úÖ LPCFileScanner loaded successfully');
        }
    </script>
    <script src="test-paths.js"></script>

    <script>
        let consoleElement = document.getElementById('console');
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;

        // Redirect console output to our custom console
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            logToCustomConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            logToCustomConsole(args.join(' '), 'error');
        };

        function logToCustomConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'color: #ff6666' : 'color: #00ff00';
            consoleElement.innerHTML += `<span style="${colorClass}">[${timestamp}] ${message}</span>\n`;
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }

        function clearConsole() {
            consoleElement.innerHTML = '';
        }

        function updateProgress(percent) {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');

            if (percent === 0) {
                progressContainer.style.display = 'none';
            } else {
                progressContainer.style.display = 'block';
                progressBar.style.width = percent + '%';
                if (percent >= 100) {
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                    }, 2000);
                }
            }
        }

        async function loadLPCData() {
            const loadBtn = document.getElementById('loadLPCBtn');
            loadBtn.disabled = true;
            loadBtn.textContent = 'üîÑ Loading...';

            try {
                console.log('üîÑ Initializing LPC Data Extractor...');

                // Initialize the LPC data extractor
                if (!window.lpcExtractor) {
                    console.log('‚ùå LPC Extractor not found, creating new instance...');
                    window.lpcExtractor = new LPCDataExtractor();
                }

                await window.lpcExtractor.extractFromLPCGenerator();

                console.log('‚úÖ LPC Data loaded successfully!');

                // Enable other buttons
                document.getElementById('testPathsBtn').disabled = false;
                document.getElementById('quickTestBtn').disabled = false;

                loadBtn.textContent = '‚úÖ LPC Data Loaded';

            } catch (error) {
                console.error('‚ùå Failed to load LPC data:', error);
                loadBtn.textContent = '‚ùå Load Failed';
                loadBtn.disabled = false;
            }
        }

        async function runPathTest() {
            const testBtn = document.getElementById('testPathsBtn');
            testBtn.disabled = true;
            testBtn.textContent = 'üß™ Testing...';

            try {
                updateProgress(10);
                console.log('üß™ Starting comprehensive path test...');

                // First ensure LPC data is loaded
                console.log('üì• Loading LPC data...');
                await loadLPCData();
                console.log('‚úÖ LPC data loaded successfully');

                updateProgress(50);
                const results = await testPathExtraction();

                updateProgress(100);
                console.log('‚úÖ Path testing completed!');
                console.log('üìÅ Check your downloads for the exported files.');

                testBtn.textContent = '‚úÖ Test Complete';

            } catch (error) {
                console.error('‚ùå Path testing failed:', error);
                testBtn.textContent = '‚ùå Test Failed';
            } finally {
                setTimeout(() => {
                    testBtn.disabled = false;
                    testBtn.textContent = 'üß™ Test All Paths';
                }, 3000);
            }
        }

        async function runFileScan() {
            const scanBtn = document.getElementById('scanFilesBtn');
            scanBtn.disabled = true;
            scanBtn.textContent = 'üìÅ Scanning...';

            try {
                updateProgress(20);
                console.log('üìÅ Starting comprehensive file scan...');

                const results = await runLPCScan();

                updateProgress(100);
                console.log('‚úÖ File scan completed!');
                console.log(`üìä Found ${results.summary.totalValidPaths} valid sprite paths`);
                console.log('üìÅ Results downloaded automatically');

                scanBtn.textContent = '‚úÖ Scan Complete';

                // Enable other buttons now that we have real file data
                document.getElementById('testPathsBtn').disabled = false;
                document.getElementById('quickTestBtn').disabled = false;

            } catch (error) {
                console.error('‚ùå File scan failed:', error);
                scanBtn.textContent = '‚ùå Scan Failed';
            } finally {
                setTimeout(() => {
                    scanBtn.disabled = false;
                    scanBtn.textContent = 'üìÅ Scan LPC Files';
                }, 3000);
            }
        }

         async function runCompleteLPCScan() {
            const scanBtn = document.getElementById('scanFilesBtn');
            scanBtn.disabled = true;
            scanBtn.textContent = 'üå≥ Scanning All...';

            try {
                updateProgress(20);
                console.log('üå≥ Starting COMPLETE file scan of entire directory tree...');

                const results = await runCompleteDirectoryScan(); // Assuming this function exists in lpc-file-scanner.js

                updateProgress(100);
                console.log('‚úÖ Complete file scan completed!');
                console.log(`üìä Found ${results.summary.totalValidPaths} valid sprite paths`);
                console.log('üìÅ Results downloaded automatically');

                scanBtn.textContent = '‚úÖ Scan Complete';

                // Enable other buttons now that we have real file data
                document.getElementById('testPathsBtn').disabled = false;
                document.getElementById('quickTestBtn').disabled = false;

            } catch (error) {
                console.error('‚ùå File scan failed:', error);
                scanBtn.textContent = '‚ùå Scan Failed';
            } finally {
                setTimeout(() => {
                    scanBtn.disabled = false;
                    scanBtn.textContent = 'üìÅ Scan LPC Files';
                }, 3000);
            }
        }

        async function runQuickTest() {
            const quickBtn = document.getElementById('quickTestBtn');
            quickBtn.disabled = true;
            quickBtn.textContent = '‚ö° Running...';

            try {
                console.log('‚ö° Running quick path discovery...');

                const paths = discoverAllSpritePaths();
                if (paths) {
                    console.log(`üìä Found ${paths.length} sprite paths`);

                    // Test first 10 paths as sample
                    console.log('üîç Testing sample paths...');
                    for (let i = 0; i < Math.min(10, paths.length); i++) {
                        const path = paths[i];
                        try {
                            const response = await fetch(path, { method: 'HEAD' });
                            console.log(`${response.ok ? '‚úÖ' : '‚ùå'} ${path}`);
                        } catch (error) {
                            console.log(`‚ùå ${path} - ${error.message}`);
                        }
                    }
                }

                quickBtn.textContent = '‚úÖ Quick Test Done';

            } catch (error) {
                console.error('‚ùå Quick test failed:', error);
                quickBtn.textContent = '‚ùå Quick Test Failed';
            } finally {
                setTimeout(() => {
                    quickBtn.disabled = false;
                    quickBtn.textContent = '‚ö° Quick Test';
                }, 3000);
            }
        }

        // Auto-load on page load
        window.addEventListener('load', () => {
            console.log('üéÆ Sprite Path Tester initialized');
            console.log('üìã Click "Load LPC Data" to begin testing');
        });
    </script>
</body>
</html>